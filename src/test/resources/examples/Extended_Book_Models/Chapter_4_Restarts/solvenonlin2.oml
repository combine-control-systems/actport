function [out_1] = subsystem_2 ()
scsm = instantiate_diagram();
scsm = set_diagram_bg_color (scsm, [1, 1, 1]);
scsm = set_diagram_3d (scsm, 1);
scsm = set_diagram_zoom (scsm, 1);
scsm = set_diagram_name (scsm, 'solve non linear system');
scsm = set_diagram_context(scsm, {['if count==1',char(10),'  n=prod(sz);N=2*n;',char(10),'  G=[eye(n,n),eye(n,n)];G=G(:,1:N);',char(10),'  P=[eye(n,n),eye(n,n)];P=P(:,1:N);',char(10),'  wi=ones(1,N)*1e32;',char(10),'  TT=[G;P;wi];',char(10),'else',char(10),'  TT=GetFromBase(''_TT'',[]);',char(10),'end']});
blk = instantiate_block('system/CustomBlocks/OmlCustomBlock');
blk = set_block_origin(blk,[13.644745,-88.805729]);
blk = set_block_size(blk,[84.000000,60.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.000000,0.690196,0.941176,1.000000]);
blk = set_block_nin (blk,3);
blk = set_block_nout (blk,2);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,0);
params=struct();
params.nin='3';
params.inports=struct('inrow',{{'-1','-1','-3'}},'incol',{{'-2','-2','-4'}},'it',{{'''double''','''double''','''double'''}},'depu',{{'1','1','1'}},'name',{{'''p''','''gp''','''TT'''}});
params.nevin='1';
params.nout='2';
params.outports=struct('outrow',{{'-1','-3'}},'outcol',{{'-2','-4'}},'ot',{{'''double''','''double'''}},'name',{{'''pnew''','''TT'''}});
params.nevout='0';
params.evoutports=struct('fir',{{}});
params.xx='[]';
params.xd='[]';
params.z='[]';
params.noz='0';
params.ozparams=struct('oztyp',{{}},'ozvalue',{{}},'name',{{}});
params.rpar='[]';
params.ipar='[]';
params.nopar='1';
params.oparparams=struct('opartyp',{{'''double'''}},'oparvalue',{{'sz'}},'name',{{'''sz'''}});
params.inlined='1';
params.code='[''function [pnext,TT]=nsolve(p,gp,TT)'',char(10),''  n=length(p);N=size(TT,2);'',char(10),''  G=TT(1:n,:);P=TT(1+n:2*n,:);wi=TT(2*n+1,:);'',char(10),''  wi=wi*(1+1/n);'',char(10),''  [_x,idx]=max(wi);'',char(10),''  G(:,idx)=gp;P(:,idx)=p;wi(idx)=gp''''*gp;'',char(10),''  [Q,R]=qr(G'''');r=rank(R);Gperp=Q*[zeros(N-r,r);eye(r)];'',char(10),''  At=ones(1,N)*Gperp;Bt=P*Gperp;Ct=Gperp;'',char(10),''  A=kron(At'''',eye(n));b=Bt(:);C=kron(Ct'''',eye(n));'',char(10),''  Wi=kron(diag(wi),eye(n));'',char(10),''  m=size(A,1);'',char(10),''  pnext=[eye(n),zeros(n,m)]*...'',char(10),''    inv([A,-C*Wi*C'''';zeros(n,n),A''''])*[b;zeros(n,1)];'',char(10),''  if norm(p-pnext)<eps'',char(10),''    pnext=pnext+2*eps*rand(n,1);'',char(10),''  end'',char(10),''  TT=[G;P;wi];'',char(10),''end'',char(10),char(10),''function OmlBlockFunction(block,flag)'',char(10),''  p=vssGetInputData(block,1);'',char(10),''  gp=vssGetInputData(block,2);'',char(10),''  TT=vssGetInputData(block,3);'',char(10),''  sz=vssGetOparData(block,1);'',char(10),''  if flag==vssBlockOutputUpdateFlag'',char(10),''    [pnext,TT]=nsolve(p(:),gp(:),TT);'',char(10),char(9),''pnext=reshape(pnext,sz(1),sz(2));'',char(10),''    vssSetOutputData(block,1,pnext,1);'',char(10),''    vssSetOutputData(block,2,TT,1);'',char(10),''  end'',char(10),''end'']';
params.fcn=struct('slib',{{''''''}},'epoint',{{''''''}});
params.impl='0';
params.nmode='0';
params.nzcr='0';
params.dept='''Standard mode''';
blk = set_block_parameters(blk,params);
[scsm, block_tag0] = add_block(scsm, blk, 'OmlCustomBlock');
blk = instantiate_block('system/MatrixOperations/MatrixNorm');
blk = set_block_origin(blk,[-16.759644,-124.183754]);
blk = set_block_size(blk,[48.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.normtype='''2-Norm''';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag1] = add_block(scsm, blk, 'MatrixNorm');
blk = instantiate_block('system/LogicalOperations/CompareToConstant');
blk = set_block_origin(blk,[42.322781,-124.183754]);
blk = set_block_size(blk,[48.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.op='''<''';
params.C='ftol';
params.zcr='0';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag2] = add_block(scsm, blk, 'CompareToConstant');
blk = instantiate_block('system/LogicalOperations/CompareToConstant');
blk = set_block_origin(blk,[-0.063576,-156.556183]);
blk = set_block_size(blk,[84.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.op='''>''';
params.C='maxiter';
params.zcr='0';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag3] = add_block(scsm, blk, 'CompareToConstant_1');
blk = instantiate_block('system/LogicalOperations/LogicalOp');
blk = set_block_origin(blk,[104.240334,-139.183754]);
blk = set_block_size(blk,[48.000000,36.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,0.000000,1.000000]);
blk = set_block_nin (blk,2);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.nin='2';
params.rule='''OR''';
params.Datatype='''double''';
params.tp='0';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag4] = add_block(scsm, blk, 'LogicalOp');
blk = instantiate_block('system/SignalExporters/ToBase');
blk = set_block_origin(blk,[109.916176,-91.805729]);
blk = set_block_size(blk,[48.000000,36.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.572549,0.815686,0.313725,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.varname='''_TT''';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag5] = add_block(scsm, blk, 'ToBase');
blk = instantiate_block('system/Links/Split');
blk = set_block_origin(blk,[-26.874092,-58.805729]);
blk = set_block_size(blk,[0.000000,0.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.250980,0.250980,0.250980,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,3);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
blk = set_block_parameters(blk,params);
[scsm, block_tag6] = add_block(scsm, blk, 'Split');
blk = instantiate_block('system/SignalGenerators/Constant');
blk = set_block_origin(blk,[-53.307076,-156.556183]);
blk = set_block_size(blk,[36.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,0.000000,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.C='count';
params.typ='''double''';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag7] = add_block(scsm, blk, 'Constant');
blk = instantiate_block('system/Ports/Input');
blk = set_block_ident (blk,'p');
blk = set_block_origin(blk,[-53.307076,-32.307968]);
blk = set_block_size(blk,[20.000000,20.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,1.000000,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.portNumber='1';
params.outsize='[-1;-2]';
params.outtyp='''inherit''';
params.dept='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag8] = add_block(scsm, blk, 'p');
blk = instantiate_block('system/Ports/Output');
blk = set_block_ident (blk,'pnew');
blk = set_block_origin(blk,[176.464417,-53.805729]);
blk = set_block_size(blk,[20.000000,20.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,1.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.portNumber='1';
params.insize='[-1;-2]';
params.intyp='''inherit''';
blk = set_block_parameters(blk,params);
[scsm, block_tag9] = add_block(scsm, blk, 'pnew');
blk = instantiate_block('system/Ports/Input');
blk = set_block_ident (blk,'g(p)');
blk = set_block_origin(blk,[-53.307076,-68.805729]);
blk = set_block_size(blk,[20.000000,20.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,1.000000,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.portNumber='2';
params.outsize='[-1;-2]';
params.outtyp='''inherit''';
params.dept='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag10] = add_block(scsm, blk, 'g(p)');
blk = instantiate_block('system/Ports/EventInput');
blk = set_block_origin(blk,[45.644745,-15.620737]);
blk = set_block_size(blk,[20.000000,20.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,1.000000,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,1);
params=struct();
params.portNumber='1';
blk = set_block_parameters(blk,params);
[scsm, block_tag11] = add_block(scsm, blk, 'EventInput_1_1');
blk = instantiate_block('system/SignalGenerators/Constant');
blk = set_block_origin(blk,[-22.098022,-90.805729]);
blk = set_block_size(blk,[24.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.572549,0.815686,0.313725,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.C='TT';
params.typ='''double''';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag12] = add_block(scsm, blk, 'Constant_1');
blk = instantiate_block('system/Ports/Output');
blk = set_block_ident (blk,'stop');
blk = set_block_origin(blk,[174.237164,-112.010487]);
blk = set_block_size(blk,[20.000000,20.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,1.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.portNumber='2';
params.insize='[-1;-2]';
params.intyp='''inherit''';
blk = set_block_parameters(blk,params);
[scsm, block_tag13] = add_block(scsm, blk, 'stop');
blk = instantiate_block('system/Ports/Output');
blk = set_block_ident (blk,'err');
blk = set_block_origin(blk,[174.726959,-154.556183]);
blk = set_block_size(blk,[20.000000,20.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,1.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.portNumber='3';
params.insize='[-1;-2]';
params.intyp='''inherit''';
blk = set_block_parameters(blk,params);
[scsm, block_tag14] = add_block(scsm, blk, 'err');
blk = instantiate_block('system/Links/Split');
blk = set_block_origin(blk,[93.936424,-144.556183]);
blk = set_block_size(blk,[0.000000,0.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.250980,0.250980,0.250980,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,3);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
blk = set_block_parameters(blk,params);
[scsm, block_tag15] = add_block(scsm, blk, 'Block');
scsm=add_event_link(scsm,{block_tag11, '1', 'output'},{block_tag0, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag0, '1', 'output'},{block_tag9, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag8, '1', 'output'},{block_tag0, '1', 'input'}, [3.644745,-22.307968], false);
scsm=add_explicit_link(scsm,{block_tag0, '2', 'output'},{block_tag5, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag2, '1', 'input'},{block_tag1, '1', 'output'}, [], false);
scsm=add_explicit_link(scsm,{block_tag2, '1', 'output'},{block_tag4, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag3, '1', 'output'},{block_tag15, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag12, '1', 'output'},{block_tag0, '3', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag10, '1', 'output'},{block_tag6, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag1, '1', 'input'},{block_tag6, '2', 'output'}, [-26.874092,-112.183754], false);
scsm=add_explicit_link(scsm,{block_tag6, '1', 'output'},{block_tag0, '2', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag7, '1', 'output'},{block_tag3, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag4, '1', 'output'},{block_tag13, '1', 'input'}, [162.240334,-102.010487], false);
scsm=add_explicit_link(scsm,{block_tag14, '1', 'input'},{block_tag15, '2', 'output'}, [], false);
scsm=add_explicit_link(scsm,{block_tag15, '1', 'output'},{block_tag4, '2', 'input'}, [93.936424,-130.183754], false);
out_1 = scsm;
end

function [out_1] = subsystem_1 ()
scsm = instantiate_diagram();
scsm = set_diagram_bg_color (scsm, [1, 1, 1]);
scsm = set_diagram_3d (scsm, 1);
scsm = set_diagram_zoom (scsm, 1);
scsm = set_diagram_name (scsm, 'solvenonlin2');
scsm = set_diagram_context(scsm, {['if __counter__==1',char(10),char(9),'p=pi/3;',char(10),'else',char(10),char(9),'p=GetFromBase(''p'');',char(10),'end']});
blk = instantiate_super_block();
scsm0 = subsystem_2();
blk = fill_super_block(blk,scsm0);
blk = set_block_ident (blk,'solve non linear system');
blk = set_block_origin(blk,[182.979965,4.475913]);
blk = set_block_size(blk,[108.000000,48.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.572549,0.815686,0.313725,1.000000]);
blk = set_block_fg_color(blk,[0.000000,0.000000,0.000000,1.000000]);
blk = set_block_icon_text(blk,'g(p)=0','text1');
blk = set_block_nin (blk,2);
blk = set_block_nout (blk,3);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,0);
params=struct();
params.ftol.rank=0;
params.ftol.value='1e-5';
params.ftol.prompt='Stop if norm of function below this threshold';
params.ftol.evaluate = 1;
params.ftol.enable=1;
params.ftol.visible=1;
params.ftol.parameter_style= { 'entry', {}};
params.ftol.callback= '';
params.ftol.tabname= 'Parameters';
params.ftol.tooltip= '';
params.ftol.buttonimage= '';
params.ftol.buttontext= '';
params.ftol.buttontooltip= '';
params.ftol.type= 'scalar';
params.ftol.dimensions= '[]';
params.ftol.unit= '';
params.maxiter.rank=1;
params.maxiter.value='130';
params.maxiter.prompt='Maximum number of iterations';
params.maxiter.evaluate = 1;
params.maxiter.enable=1;
params.maxiter.visible=1;
params.maxiter.parameter_style= { 'entry', {}};
params.maxiter.callback= '';
params.maxiter.tabname= 'Parameters';
params.maxiter.tooltip= '';
params.maxiter.buttonimage= '';
params.maxiter.buttontext= '';
params.maxiter.buttontooltip= '';
params.maxiter.type= 'scalar';
params.maxiter.dimensions= '[]';
params.maxiter.unit= '';
params.sz.rank=2;
params.sz.value='[1,1]';
params.sz.prompt='size of system';
params.sz.evaluate = 1;
params.sz.enable=1;
params.sz.visible=1;
params.sz.parameter_style= { 'entry', {}};
params.sz.callback= '';
params.sz.tabname= 'Parameters';
params.sz.tooltip= '';
params.sz.buttonimage= '';
params.sz.buttontext= '';
params.sz.buttontooltip= '';
params.sz.type= 'matrix';
params.sz.dimensions= '[1,2]';
params.sz.unit= '';
params.count.rank=3;
params.count.value='__counter__';
params.count.prompt='iteration number (do not edit)';
params.count.evaluate = 1;
params.count.enable=1;
params.count.visible=1;
params.count.parameter_style= { 'entry', {}};
params.count.callback= '';
params.count.tabname= 'Parameters';
params.count.tooltip= '';
params.count.buttonimage= '';
params.count.buttontext= '';
params.count.buttontooltip= '';
params.count.type= 'scalar';
params.count.dimensions= '[]';
params.count.unit= '';
blk = set_block_mask(blk,params,'Nonliear solver');
blk = set_atomic_property(blk,0);
[scsm, block_tag0] = add_block(scsm, blk, 'solve non linear system');
blk = instantiate_block('system/ActivationOperations/IfThenElse');
blk = set_block_origin(blk,[316.875832,-45.524087]);
blk = set_block_size(blk,[48.000000,36.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.000000,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,2);
params=struct();
params.externalActivation='1';
params.nmod='1';
blk = set_block_parameters(blk,params);
[scsm, block_tag1] = add_block(scsm, blk, 'IfThenElse_1');
blk = instantiate_block('system/ActivationOperations/End');
blk = set_block_origin(blk,[378.555977,-33.524087]);
blk = set_block_size(blk,[48.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.000000,0.000000,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,0);
params=struct();
params.job='''Restart''';
params.bmessage='''''';
blk = set_block_parameters(blk,params);
[scsm, block_tag2] = add_block(scsm, blk, 'End');
blk = instantiate_block('system/ActivationOperations/IfThenElse');
blk = set_block_origin(blk,[366.555977,10.475913]);
blk = set_block_size(blk,[48.000000,36.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.000000,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,2);
params=struct();
params.externalActivation='1';
params.nmod='1';
blk = set_block_parameters(blk,params);
[scsm, block_tag3] = add_block(scsm, blk, 'IfThenElse');
blk = instantiate_block('system/ActivationOperations/End');
blk = set_block_origin(blk,[304.875832,-89.524087]);
blk = set_block_size(blk,[48.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.000000,0.000000,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,0);
params=struct();
params.job='''Error''';
params.bmessage='''Max number of iterations reached''';
blk = set_block_parameters(blk,params);
[scsm, block_tag4] = add_block(scsm, blk, 'End_1');
blk = instantiate_block('system/ActivationOperations/End');
blk = set_block_origin(blk,[369.625725,-89.524087]);
blk = set_block_size(blk,[48.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.000000,0.000000,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,0);
params=struct();
params.job='''Stop''';
params.bmessage='''Successful''';
blk = set_block_parameters(blk,params);
[scsm, block_tag5] = add_block(scsm, blk, 'End_1_1');
blk = instantiate_block('system/SignalGenerators/Constant');
blk = set_block_origin(blk,[-145.947491,53.740625]);
blk = set_block_size(blk,[24.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.572549,0.815686,0.313725,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.C='p';
params.typ='''double''';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag6] = add_block(scsm, blk, 'Constant');
blk = instantiate_block('system/SignalViewers/Display');
blk = set_block_ident (blk,'g(p)=x-d');
blk = set_block_origin(blk,[194.230087,-50.144962]);
blk = set_block_size(blk,[72.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,1.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.fmt='''%6g''';
params.dt='1';
params.showatend='0';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag7] = add_block(scsm, blk, 'g(p)=x-d');
blk = instantiate_block('system/SignalViewers/Display');
blk = set_block_ident (blk,'p = θ ');
blk = set_block_origin(blk,[-76.119202,98.011543]);
blk = set_block_size(blk,[60.000000,24.000000]);
blk = set_block_flip(blk,1);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,1.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.fmt='''%6g''';
params.dt='1';
params.showatend='0';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag8] = add_block(scsm, blk, 'p = θ ');
blk = instantiate_block('system/SignalExporters/ToBase');
blk = set_block_origin(blk,[310.979965,35.005920]);
blk = set_block_size(blk,[48.000000,36.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.572549,0.815686,0.313725,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,0);
params=struct();
params.varname='''p''';
params.externalActivation='1';
blk = set_block_parameters(blk,params);
[scsm, block_tag9] = add_block(scsm, blk, 'ToBase');
blk = instantiate_block('system/Links/ActivationSplit');
blk = set_block_origin(blk,[236.979965,79.768021]);
blk = set_block_size(blk,[0.000000,0.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.717647,0.058824,0.074510,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,3);
params=struct();
blk = set_block_parameters(blk,params);
[scsm, block_tag10] = add_block(scsm, blk, 'ActivationSplit');
blk = instantiate_block('system/Links/ActivationSplit');
blk = set_block_origin(blk,[334.979965,81.005920]);
blk = set_block_size(blk,[0.000000,0.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.717647,0.058824,0.074510,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,3);
params=struct();
blk = set_block_parameters(blk,params);
[scsm, block_tag11] = add_block(scsm, blk, 'Block');
blk = instantiate_block('system/Dynamical/Integral');
blk = set_block_ident (blk,'position');
blk = set_block_origin(blk,[56.851601,-25.524087]);
blk = set_block_size(blk,[24.000000,60.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.752941,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.x0='0';
params.reinit='0';
params.satur='0';
params.limit=struct('max',{{}},'min',{{}},'zcross',{{}});
blk = set_block_parameters(blk,params);
[scsm, block_tag12] = add_block(scsm, blk, 'position');
blk = instantiate_block('system/Dynamical/Integral');
blk = set_block_ident (blk,'velocity');
blk = set_block_origin(blk,[0.851601,-19.524087]);
blk = set_block_size(blk,[36.000000,48.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.752941,0.000000,1.000000]);
blk = set_block_nin (blk,2);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,1);
blk = set_block_evtnout (blk,0);
params=struct();
params.x0='[0;0]';
params.reinit='1';
params.satur='0';
params.limit=struct('max',{{}},'min',{{}},'zcross',{{}});
blk = set_block_parameters(blk,params);
[scsm, block_tag13] = add_block(scsm, blk, 'velocity');
blk = instantiate_block('system/Routing/Demux');
blk = set_block_origin(blk,[96.351601,-19.524087]);
blk = set_block_size(blk,[6.000000,48.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.752941,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,2);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.nout='2';
params.outports=struct('size',{{'1','1'}});
blk = set_block_parameters(blk,params);
[scsm, block_tag14] = add_block(scsm, blk, 'Demux');
blk = instantiate_block('system/MatrixOperations/MatrixExpression');
blk = set_block_origin(blk,[-145.478210,-81.050652]);
blk = set_block_size(blk,[180.000000,36.000000]);
blk = set_block_flip(blk,1);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.752941,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.nin='1';
params.work='getcurrentenv()';
params.exx='''-a*(sqrt(u1''''*u1)^(b-1))*u1 + [0;-g]''';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag15] = add_block(scsm, blk, 'MatrixExpression_1');
blk = instantiate_block('system/Links/Split');
blk = set_block_origin(blk,[46.851601,4.475913]);
blk = set_block_size(blk,[0.000000,0.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.250980,0.250980,0.250980,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,3);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
blk = set_block_parameters(blk,params);
[scsm, block_tag16] = add_block(scsm, blk, 'Split_1');
blk = instantiate_block('system/ActivationOperations/ZeroCrossDown');
blk = set_block_origin(blk,[218.979965,89.768021]);
blk = set_block_size(blk,[36.000000,36.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.000000,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,1);
params=struct();
params.dept='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag17] = add_block(scsm, blk, 'ZeroCrossDown_1');
blk = instantiate_block('system/MatrixOperations/MatrixExpression');
blk = set_block_origin(blk,[-123.195518,-19.524087]);
blk = set_block_size(blk,[108.000000,24.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.nin='1';
params.work='getcurrentenv()';
params.exx='''[cos(u1);sin(u1)]*V''';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag18] = add_block(scsm, blk, 'MatrixExpression');
blk = instantiate_block('system/Links/Split');
blk = set_block_origin(blk,[-84.832684,40.479467]);
blk = set_block_size(blk,[0.000000,0.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.250980,0.250980,0.250980,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,3);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
blk = set_block_parameters(blk,params);
[scsm, block_tag19] = add_block(scsm, blk, 'Block_2');
blk = instantiate_block('system/ActivationOperations/InitialEvent');
blk = set_block_origin(blk,[-5.148399,48.475913]);
blk = set_block_size(blk,[48.000000,36.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.000000,0.000000,1.000000]);
blk = set_block_nin (blk,0);
blk = set_block_nout (blk,0);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,1);
[scsm, block_tag20] = add_block(scsm, blk, 'InitialEvent');
blk = instantiate_block('system/MathOperations/Bias');
blk = set_block_origin(blk,[116.068939,-1.524087]);
blk = set_block_size(blk,[36.000000,36.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,0.752941,0.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.b='-d';
params.over='''Nothing''';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag21] = add_block(scsm, blk, 'Bias');
blk = instantiate_block('system/Links/Split');
blk = set_block_origin(blk,[172.259186,16.475913]);
blk = set_block_size(blk,[0.000000,0.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.250980,0.250980,0.250980,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,3);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
blk = set_block_parameters(blk,params);
[scsm, block_tag22] = add_block(scsm, blk, 'Split');
blk = instantiate_block('system/SignalConversions/UnitConversion');
blk = set_block_ident (blk,'UnitConversion');
blk = set_block_origin(blk,[50.229935,90.011543]);
blk = set_block_size(blk,[90.000000,40.000000]);
blk = set_block_flip(blk,1);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[1.000000,1.000000,1.000000,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,1);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
params.ucategory=struct('Temperature','0','Volume','0','Pressure','0','Distance','0','Speed','0','Acceleration','0','Force','0','Energy','0','Power','0','Mass','0','Flow','0','Area','0','Charge','0','Volt','0','Current','0','Resistance','0','Capacitance','0','Magnetic_Flux','0','Inductance','0','Torque','0','Rotary_Inertia','0','Rotation','1','Rotational_Speed','0','Density','0','Enthalpy','0');;
params.PI_Temperature='''celsius''';
params.PO_Temperature='''celsius''';
params.PI_Volume='''m^3''';
params.PO_Volume='''m^3''';
params.PI_Pressure='''N/m^2 (Pascal)''';
params.PO_Pressure='''N/m^2 (Pascal)''';
params.PI_Distance='''m''';
params.PO_Distance='''m''';
params.PI_Speed='''m/s''';
params.PO_Speed='''m/s''';
params.PI_Acceleration='''m/s^2''';
params.PO_Acceleration='''m/s^2''';
params.PI_Force='''N''';
params.PO_Force='''N''';
params.PI_Energy='''Joule''';
params.PO_Energy='''Joule''';
params.PI_Power='''Watt''';
params.PO_Power='''Watt''';
params.PI_Mass='''kg''';
params.PO_Mass='''kg''';
params.PI_Flow='''m^3/s''';
params.PO_Flow='''m^3/s''';
params.PI_Area='''m^2''';
params.PO_Area='''m^2''';
params.PI_Charge='''coulomb''';
params.PO_Charge='''coulomb''';
params.PI_Volt='''volt''';
params.PO_Volt='''volt''';
params.PI_Current='''ampere''';
params.PO_Current='''ampere''';
params.PI_Resistance='''ohm''';
params.PO_Resistance='''ohm''';
params.PI_Capacitance='''farad''';
params.PO_Capacitance='''farad''';
params.PI_Magnetic_Flux='''weber''';
params.PO_Magnetic_Flux='''weber''';
params.PI_Inductance='''henry''';
params.PO_Inductance='''henry''';
params.PI_Torque='''kg.m''';
params.PO_Torque='''kg.m''';
params.PI_Rotary_Inertia='''kg.cm.s^2''';
params.PO_Rotary_Inertia='''kg.cm.s^2''';
params.PI_Rotation='''radians''';
params.PO_Rotation='''degrees''';
params.PI_Rotational_Speed='''rad/sec''';
params.PO_Rotational_Speed='''rad/sec''';
params.PI_Density='''g/cm^3''';
params.PO_Density='''g/cm^3''';
params.PI_Enthalpy='''kJ/kg''';
params.PO_Enthalpy='''kJ/kg''';
params.externalActivation='0';
blk = set_block_parameters(blk,params);
[scsm, block_tag23] = add_block(scsm, blk, 'UnitConversion');
blk = instantiate_block('system/Links/Split');
blk = set_block_origin(blk,[154.533157,40.479467]);
blk = set_block_size(blk,[0.000000,0.000000]);
blk = set_block_flip(blk,0);
blk = set_block_theta(blk,0.000000);
blk = set_block_bg_color(blk,[0.250980,0.250980,0.250980,1.000000]);
blk = set_block_nin (blk,1);
blk = set_block_nout (blk,3);
blk = set_block_evtnin (blk,0);
blk = set_block_evtnout (blk,0);
params=struct();
blk = set_block_parameters(blk,params);
[scsm, block_tag24] = add_block(scsm, blk, 'Block_1');
scsm=add_event_link(scsm,{block_tag4, '1', 'input'},{block_tag1, '1', 'output'}, [], false);
scsm=add_event_link(scsm,{block_tag1, '2', 'output'},{block_tag5, '1', 'input'}, [], false);
scsm=add_event_link(scsm,{block_tag3, '1', 'output'},{block_tag1, '1', 'input'}, [], false);
scsm=add_event_link(scsm,{block_tag3, '2', 'output'},{block_tag2, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag0, '2', 'output'},{block_tag3, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag0, '3', 'output'},{block_tag1, '1', 'input'}, [300.979965,-27.524087], false);
scsm=add_explicit_link(scsm,{block_tag6, '1', 'output'},{block_tag19, '1', 'input'}, [-84.832684,65.740625], false);
scsm=add_explicit_link(scsm,{block_tag0, '1', 'output'},{block_tag9, '1', 'input'}, [], false);
scsm=add_event_link(scsm,{block_tag17, '1', 'output'},{block_tag10, '1', 'input'}, [], false);
scsm=add_event_link(scsm,{block_tag9, '1', 'input'},{block_tag11, '1', 'output'}, [], false);
scsm=add_event_link(scsm,{block_tag10, '1', 'output'},{block_tag0, '1', 'input'}, [], false);
scsm=add_event_link(scsm,{block_tag3, '1', 'input'},{block_tag11, '2', 'output'}, [390.555977,81.005920], false);
scsm=add_event_link(scsm,{block_tag11, '1', 'input'},{block_tag10, '2', 'output'}, [236.979965,81.005920], false);
scsm=add_explicit_link(scsm,{block_tag15, '1', 'output'},{block_tag13, '1', 'input'}, [-155.478210,16.475913], false);
scsm=add_explicit_link(scsm,{block_tag16, '2', 'output'},{block_tag15, '1', 'input'}, [46.851601,-63.050652], false);
scsm=add_explicit_link(scsm,{block_tag16, '1', 'output'},{block_tag12, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag13, '1', 'output'},{block_tag16, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag12, '1', 'output'},{block_tag14, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag14, '2', 'output'},{block_tag17, '1', 'input'}, [161.521790,-7.524087;161.521790,107.768021], false);
scsm=add_explicit_link(scsm,{block_tag14, '1', 'output'},{block_tag21, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag18, '1', 'output'},{block_tag13, '2', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag18, '1', 'input'},{block_tag19, '2', 'output'}, [-133.195518,40.479467], false);
scsm=add_explicit_link(scsm,{block_tag19, '1', 'output'},{block_tag24, '1', 'input'}, [], false);
scsm=add_event_link(scsm,{block_tag20, '1', 'output'},{block_tag13, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag21, '1', 'output'},{block_tag22, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag7, '1', 'input'},{block_tag22, '2', 'output'}, [172.259186,-38.144962], false);
scsm=add_explicit_link(scsm,{block_tag22, '1', 'output'},{block_tag0, '2', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag23, '1', 'output'},{block_tag8, '1', 'input'}, [], false);
scsm=add_explicit_link(scsm,{block_tag23, '1', 'input'},{block_tag24, '2', 'output'}, [154.533157,110.011543], false);
scsm=add_explicit_link(scsm,{block_tag24, '1', 'output'},{block_tag0, '1', 'input'}, [], false);
blk = instantiate_block('TEXT_f');
blk = set_block_ident(blk, 'Annotation');
blk = set_block_origin(blk,[103.639358,44.463264]);
blk = set_block_size(blk,[30.000000,28.000000]);
params=struct();
  params.txt='x';
blk = set_block_parameters (blk, params);
[scsm, block_tag25] = add_block(scsm, blk, 'Annotation');
blk = instantiate_block('TEXT_f');
blk = set_block_ident(blk, 'Annotation_1');
blk = set_block_origin(blk,[104.652803,-4.143541]);
blk = set_block_size(blk,[30.000000,28.000000]);
params=struct();
  params.txt='y';
blk = set_block_parameters (blk, params);
[scsm, block_tag26] = add_block(scsm, blk, 'Annotation_1');
blk = instantiate_block('TEXT_f');
blk = set_block_ident(blk, 'Annotation_2');
blk = set_block_origin(blk,[203.591583,85.714149]);
blk = set_block_size(blk,[44.000000,24.000000]);
params=struct();
  params.txt='y=0';
blk = set_block_parameters (blk, params);
[scsm, block_tag27] = add_block(scsm, blk, 'Annotation_2');
out_1 = scsm;
end

solvenonlin2 = subsystem_1();
solvenonlin2 = set_model_workspace (solvenonlin2, {['a=.1;',char(10),'b=2.5;',char(10),'g=9.8;',char(10),'V=1000;',char(10),'d=9;']});
solvenonlin2 = set_initial_time (solvenonlin2, '0');
solvenonlin2 = set_final_time (solvenonlin2, '100');
tol = {'0.000001', '0.000001', '-1', '0' , '0', 'lsodar', '-1'};
solvenonlin2 = set_solver_parameters( solvenonlin2, tol);
solvenonlin2 = evaluate_model (solvenonlin2);
scsm = solvenonlin2;
